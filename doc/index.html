<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <title>Documentation | Autotest</title>
    <meta
      name="description"
      content="Accessibility test automation"
    >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="favicon.png">
    <link rel="stylesheet" href="../style.css">
  </head>
  <body>
    <main>
      <h1>Autotest documentation</h1>
      <section class="head">
        <h2>Introduction</h2>
        <p>This page documents Autotest.</p>
      </section>
      <div class="etc">
        <section>
          <h2>What is Autotest?</h2>
          <p>Autotest is a prototype application investigating methods of web-application test automation, with an emphasis on tests for accessibility.</p>
          <h2>System requirements</h2>
          <p>Autotest needs to be installed on a computer where version 14 or later of <a href="https://nodejs.org/en/">Node.js</a> is installed.</p>
          <h2>What does Autotest do?</h2>
          <p>Autotest performs automated tests on web documents.</p>
          <h2>What technologies does Autotest use?</h2>
          <p>Autotest uses Node.js to run an HTTP(S) server to interact with you, the user, and an HTTP(S) client to interact with websites.</p>
          <p>Autotest uses the <a href="https://playwright.dev/">Playwright</a> package to launch browsers, perform user actions in them, and perform tests.</p>
          <h2>How do you use Autotest?</h2>
          <p>You give instructions to Autotest in a <dfn>script</dfn>. A script follows rules documented below. Each script is a sequence of <dfn>commands</dfn>, namely instructions for things that Autotest should do, called <dfn>acts</dfn>.</p>
          <p>Each script is stored in its own file, located in a scripts directory.</p>
          <p>It is possible to have more than one scripts directory.</p>
          <p>After you install Autotest and its dependencies, you open a command shell (a terminal), navigate to the Autotest directory, and enter the command <code>node index</code>. That causes Autotest&rsquo;s server to start. The server listens for requests on port 3000 of your computer, <code>localhost</code>.</p>
          <p>To make requests, you visit <code>localhost:3000/autotest</code> with a web browser and follow the instructions displayed by Autotest.</p>
          <p>The sequence is:</p>
          <ol>
            <li>Autotest asks you for the location and name of the scripts directory that you want it to use. If you have put a line such as <code>SCRIPTDIR=../autotest-scripts</code> into a <code>.env</code> file, Autotest will propose the path from that line as the scripts directory, and you can accept it or change it to another path.</li>
            <li>Autotest shows you a list of the scripts in the directory you specified.</li>
            <li>You choose one of those scripts.</li>
            <li>Autotest performs the acts specified by the commands in that script.</li>
            <li>Autotest outputs a report to your browser.</li>
            <li>As it proceeds, Autotest also writes a copy of the report to a <code>report-xxx.json</code> file (where <code>xxx</code> represents a timestamp). In case Autotest throws an error or while performing the acts or takes longer than your browser is willing to wait, the browser report may fail to appear, but the file report, up to the point of the error or disconnection, will be preserved.</li>
            <li>When you have finished using Autotest, you stop it by entering <kbd>CTRL-c</kbd>.</li>
            <li>You can perform analyses on the data in a report, using existing Autotest routines or writing your own.</li>
          </ol>
          <h2>Rules</h2>
          <p>A script is a JSON file representing an array of commands.</p>
          <p>Each command is an object.</p>
          <p>Each command has a <code>type</code> property. There is a closed set of types, and the value of <code>type</code> must be one of those types.</p>
          <p>Commands of some types also require either or both of two other properties, <code>which</code> and <code>what</code>. They provide additional information to Autotest that it needs in order to perform the commanded act, or sometimes <code>what</code> provides documentation explaining the purpose of the act.</p>
          <p>The command types, and the properties they require, are documented in the file <code>doc/commands.json</code>. This file not only tells you what the requirements are, but also specifies them to Autotest when it validates a script.</p>
          <p>The <code>commands.json</code> file represents an array of command rules, one per command type. Each rule is, in turn, an array with two elements. The first element is a description of what a command of that type does. The second element is an object that has the properties that commands of that type may or must have. Each property has an array value. The first element is a boolean value, specifying whether the property is required (<code>true</code>) or optional (<code>false</code>). The second element is a string identifying the type of value the property must have (<code>string</code> or <code>object</code>). If there is a third element, it identifies a validity rule.</p>
          <p>Here is an example of a command rule from <code>commands.json</code>:</p>
          <pre>"test": [
  "Perform a custom test (what: description)",
  {
    "which": [true, "string", "isCustomTest"],
    "what": [false, "string", "hasLength"]
  }
]</pre>
          <p>In this example, the command type is <code>test</code>, and the purpose of the command is to perform a custom test. A command of this type must have a <code>which</code> property and may optionally have a <code>what</code> property. Both properties have string values. The <code>which</code> property must satisfy the <code>isCustomTest</code> requirement, which means that its value must be the name of a custom test. The <code>what</code> property, if it exists, must satisfy the <code>hasLength</code> requirement, which means it must not be a blank string.</p>
          <h2>Test-package integrations</h2>
          <p>Autotest provides opportunities to integrate two accessibility test packages, <a href="https://github.com/dequelabs/axe-core">Axe</a> and <a href="https://wave.webaim.org/">WAVE</a>, into scripts. The rules governing their commands in scripts are described above.</p>
          <h3>Axe</h3>
          <p>Axe integration depends on the <a href="https://www.npmjs.com/package/axe-playwright">axe-playwright</a> package. Violations reported with that package exclude <dfn>incomplete</dfn> (also called <q>needs-review</q>) violations and violations of <q>experimental</q> rules.</p>
          <h3>WAVE</h3>
          <p>WAVE integration depends on the user having a WAVE API key. Use of the WAVE API depletes the user&rsquo;s WAVE API credits. The <code>waves</code> command performs a WAVE test with <code>reporttype=1</code> on a specified URL. Such a test costs 1 credit ($0.04, or less in quantity). When you register with WebAIM and obtain a WAVE API key, you must add a line to your <code>.env</code> file, in the format <code>WAVE_KEY=x0x0x0x0x0x0x</code> (where <code>x0x0x0x0x0x0x</code> represents your key).</p>
          <h2>Reports</h2>
          <p>Every script produces a report in JSON format and deposits it into the <code>reports</code> directory. The report name contains an automatically generated timestamp. You can rename a report as you wish and move it to wherever you want to store it.</p>
          <h2>Repository exclusions</h2>
          <p>The files in the <code>temp</code> and <code>reports</code> directories are presumed ephemeral and are not tracked by <code>git</code>.</p>

          <h4>JHU-WAVE comparisons</h4>
          <p>One of the Autotest analysis routines performs the <dfn>JHU-WAVE</dfn> comparison. That is a comparison of web pages that have been subjected to the <code>waves</code> test in a script. The comparison follows the rule applied by the Johns Hopkins University Disability Health Research Center in its <a href="https://disabilityhealth.jhu.edu/vaccinedashboard/webaccess/">Vaccine Website Accessibility</a> dashboard. That rule is described summarily on the cited page. Missing details were obtained from WebAIM, which conducted the testing.</p>
          <p>Autotest&rsquo;s implementation of the JHU-WAVE rule is located in the <code>jhuwave.js</code> file. By executing the command <code>node jhuwave xxx</code> (where <code>xxx</code> represents the timestamp of a report file), you can apply that rule to the pages whose <code>waves</code> test results are recorded in a report file.</p>
          <p>The JHU-WAVE rule is defined as follows:</p>
          <ol>
            <li>Give each page a rank, on the basis of its error total, namely the total of its <q>Errors</q> and its <q>Contrast Errors</q>, with 0 being the best rank (i.e. the smallest total). If there is a tie for the next rank, use that rank for all of the tied pages, but then skip ranks so that the used rank plus the skipped ranks are equal in number to the number of tied pages.</li>
            <li>Give each page a rank, on the basis of its error density, namely its error total divided by the total number of its elements. Use the same rule for ties.</li>
            <li>Give each page a rank, on the basis of its alert total. Use the same rule for ties.</li>
            <li>For each page, multiply its error-total rank by 6, multiply its error-density rank by 3, and multiply its alert rank by 1.</li>
            <li>Total those three products. That total is the page&rsquo;s score. The smaller the score, the better the page, according to the JHU-WAVE rule.</li>
          </ol>
          Tests for important a11y defects not detected by Axe or WAVE
# links with href="#" (ACI)
# links and buttons that are not reachable with keyboard navigation (ACI)
# links and buttons styled non-distinguishably (ACI)
# first focused element not first focusable element in DOM (Kimball)
# skip link that is never visible (ACI); gets credit from Axe and WAVE
# button inside link (ACI)
# button with no text content
# invisible focus indicators
Weights:
# defects that intrinsically can occur only once per page versus once per element

        </section>
      </div>
    </main>
  </body>
</html>
